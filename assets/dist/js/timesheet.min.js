var splitted_uri,selectedDate=[],month="",year="";function get_timesheet_stat(){var t=new Ajax;t.type="POST",t.url=SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/timesheet_stats",t.beforeSend=function(){showAjaxLoader()},t.data={via:"ajax",month:month,year:year};var e=t.init();e.done(function(t){hideAjaxLoader(),"undefined"!=t.data.stat_data.total_days&&$("#total_days").html(t.data.stat_data.total_days),"undefined"!=t.data.stat_data.total_hrs&&$("#total_hrs").html(t.data.stat_data.total_hrs),"undefined"!=t.data.stat_data.avg_hrs&&$("#average_worked_hrs").html(t.data.stat_data.avg_hrs),$.each(t.data.data_rows,function(t,e){var a=e.timesheet_date;a=a.split("-"),$("#timesheet_calendar[data-cal-month='"+a[1]+"'][data-cal-year='"+a[0]+"'] .day").each(function(){$(this).text()==Number(a[2]).toString()&&$(this).addClass("filled")})})}),e.fail(function(){alert("Failed")}),e.always(function(){})}function renderDataTable(){this.table=$("#timesheet-datatable").DataTable({iDisplayLength:25,processing:!0,serverSide:!0,order:[],ajax:{url:SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/render_datatable",data:{year:year,month:month}},columnDefs:[{targets:[-1],orderable:!1}],initComplete:function(){$('[data-toggle="tooltip"]').tooltip()}})}$(function(){if("index"==ROUTER_METHOD){var t=$('input[name="selected_date"]').val();if(t){var e=t.split(",");0<(selectedDate=e).length&&$.each(e,function(t,e){var a=e.split("-");$("#timesheet_calendar[data-cal-month='"+a[1]+"'][data-cal-year='"+a[0]+"'] .day").each(function(){$(this).text()==a[2]&&$(this).addClass("selected")})})}if(null!=(splitted_uri=window.location.href.split("timesheet/index/"))[1]){var a=splitted_uri[1].split("/");a&&(month=a[1],year=a[0])}get_timesheet_stat(),renderDataTable();var r=$("#timesheet_calendar").attr("data-today");r=r.split("-");var d=$("#timesheet_calendar").attr("data-current-month"),n=$("#timesheet_calendar").attr("data-cal-month");$("#timesheet_calendar td.day").each(function(){var t=$(this).text();0<t.trim().length&&(d==n&&parseInt(t)>parseInt(r[2])||parseInt(t)<parseInt(r[2])-3)&&$(this).attr("data-calday","disabled_day")})}"report"==ROUTER_METHOD&&($(".report-datepicker").datepicker({format:"dd-mm-yyyy",weekStart:1,autoclose:!0}),$(".multi_select_tag").select2({allowClear:!0,width:"100%"}),$("#reset_timesheet_form").on("click",function(t){t.preventDefault(),$("#timesheet-search-form .form-control").val("")}),$(".select2-control-user").select2({ajax:{url:SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/get_user_dropdown_searchable",dataType:"json",delay:250,data:function(t){return{q:t.term,page:t.page}},cache:!0},placeholder:"Search",minimumInputLength:3}),$(".select2-control-project").select2({ajax:{url:SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/get_project_dropdown_searchable",dataType:"json",delay:250,data:function(t){return{q:t.term,page:t.page}},cache:!0},placeholder:"Search",minimumInputLength:3})),$("select").on("change",function(){var t=$(this).val(),e=$(this).attr("data-render-target"),a=$(this).attr("data-order"),r=$(this).attr("name"),d=new Ajax;d.type="POST",d.url=SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/get_project_task",d.beforeSend=function(){showAjaxLoader()},d.data={via:"ajax",current_control:r,id:t,data_render_target:e,data_order:a};var n=d.init();n.done(function(a){console.log(a),hideAjaxLoader(),$.each(a.resp_data,function(t,e){$('select[name="'+a.req_param.data_render_target+'"]').append($("<option></option>").attr("value",t).text(e))})}),n.fail(function(){alert("Failed")}),n.always(function(){})})}),$("body").on("click","td[data-calday='allowed_day']",function(t){var e=$(this).text(),a=$("#timesheet_calendar").attr("data-cal-month"),r=$("#timesheet_calendar").attr("data-cal-year")+"-"+a+"-"+e;0<e.trim().length&&($(this).hasClass("selected")?($(this).removeClass("selected"),selectedDate.splice($.inArray(r,selectedDate),1)):($(this).addClass("selected"),selectedDate.push(r))),$('input[name="selected_date"]').val(selectedDate.join())}),$("#clear_selected_days").on("click",function(t){t.preventDefault(),selectedDate=[],$('input[name="selected_date"]').val(""),$(".day").removeClass("selected")});