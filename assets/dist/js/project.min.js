var table,splitted_uri,selectedDate=[],month="",year="";function domReady(){if("index"==ROUTER_METHOD&&renderDataTable(),"tasks"==ROUTER_METHOD&&renderTasksDataTable(),"add"!=ROUTER_METHOD&&"edit"!=ROUTER_METHOD||($("#project_start_date").datepicker({format:"dd-mm-yyyy",weekStart:1,autoclose:!0,container:$("#project_start_date").parent()}),$("#project_end_date").datepicker({format:"dd-mm-yyyy",weekStart:1,autoclose:!0,container:$("#project_end_date").parent()})),"project_tasks"==ROUTER_METHOD&&$("#project_id_dd").on("change",function(e){var t=$(this).val();t&&(window.location=SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/project_tasks/pid/"+t)}),"timesheet"==ROUTER_METHOD){var e=$('input[name="selected_date"]').val();if(e){var t=e.split(",");0<(selectedDate=t).length&&$.each(t,function(e,t){$('#timesheet_calendar span.date_value[data-date="'+t+'"]').parents("td").addClass("selected")})}if(null!=(splitted_uri=window.location.href.split("project/timesheet/"))[1]){var a=splitted_uri[1].split("/");a&&(month=a[1],year=a[0])}get_timesheet_stat(),renderTimesheetDataTable();var d=$("#timesheet_calendar").attr("data-today"),r=$("#timesheet_calendar").attr("data-enable-prev-days");$("#timesheet_calendar").attr("data-enable-next-days");d=d.split("-");var n=$("#timesheet_calendar").attr("data-current-month"),s=$("#timesheet_calendar").attr("data-cal-month");$("#timesheet_calendar td.day").each(function(){var e=$(this).text();0<e.trim().length&&(n==s&&parseInt(e)>parseInt(d[2])||parseInt(e)<parseInt(d[2])-r)&&$(this).attr("data-calday","disabled_day")})}"timesheet_report"==ROUTER_METHOD&&($(".report-datepicker").datepicker({format:"dd-mm-yyyy",weekStart:1,autoclose:!0}),$(".multi_select_tag").select2({allowClear:!0,width:"100%"}),$("#reset_timesheet_form").on("click",function(e){e.preventDefault(),$("#timesheet-search-form .form-control").val("")}),$(".select2-control-user").select2({ajax:{url:SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/get_user_dropdown_searchable",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},cache:!0},placeholder:"Search",minimumInputLength:3}),$(".select2-control-project").select2({ajax:{url:SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/get_project_dropdown_searchable",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},cache:!0},placeholder:"Search",minimumInputLength:3})),$("select#dd_tasks").on("change",function(){var e=$(this).val(),t=$(this).data("render-target"),a=$(this).data("order"),d=$(this).attr("name"),r=new Ajax;r.type="POST",r.url=SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/get_project_task",r.beforeSend=function(){showAjaxLoader()},r.data={via:"ajax",current_control:d,id:e,data_render_target:t,data_order:a};var n=r.init();n.done(function(a){hideAjaxLoader();var d='<option value="">-Select-</option>';$.each(a.resp_data,function(e,t){console.log(a.resp_data),d+='<option value="'+e+'">'+t+"</option>"}),$('select[name="'+a.req_param.data_render_target+'"]').html(d)}),n.fail(function(){alert("Service call failed")}),n.always(function(){})}),$("#timesheetDetailsInfoModal").on("show.bs.modal",function(e){var t=$(e.relatedTarget),a=t.data("date"),d=t.data("emp"),r=t.data("project"),n=t.data("task"),s=t.data("hour"),l=t.data("desc"),o=$(this);o.find(".modal-title").html(a),o.find("#ts_emp_name").html(d),o.find("#ts_project").html(r),o.find("#ts_task").html(n),o.find("#ts_hours").html(s),o.find("#ts_desc").html(l)})}function renderDataTable(){table=$("#project-datatable").DataTable({iDisplayLength:50,processing:!0,serverSide:!0,order:[],ajax:{url:SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/render_datatable"},columnDefs:[{targets:[-1],orderable:!1}]})}function renderTasksDataTable(){table=$("#task-datatable").DataTable({iDisplayLength:50,processing:!0,serverSide:!0,order:[],ajax:{url:SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/render_task_datatable"},columnDefs:[{targets:[-1],orderable:!1}]})}function get_timesheet_stat(){var e=new Ajax;e.type="POST",e.url=SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/timesheet_stats",e.beforeSend=function(){showAjaxLoader()},e.data={via:"ajax",month:month,year:year};var t=e.init();t.done(function(e){hideAjaxLoader(),"undefined"!=e.data.stat_data.total_days&&$("#total_days").html(e.data.stat_data.total_days),"undefined"!=e.data.stat_data.total_hrs&&$("#total_hrs").html(e.data.stat_data.total_hrs),"undefined"!=e.data.stat_data.avg_hrs&&$("#average_worked_hrs").html(e.data.stat_data.avg_hrs),$.each(e.data.data_rows,function(e,t){var a=(d=t.timesheet_date).split("-"),d=a[0]+"-"+a[1]+"-"+a[2].replace(/^0+/,"");$('#timesheet_calendar span.date_value[data-date="'+d+'"]').parents("td").addClass("filled")})}),t.fail(function(){alert("Failed")}),t.always(function(){})}function renderTimesheetDataTable(){this.table=$("#timesheet-datatable").DataTable({iDisplayLength:50,processing:!0,serverSide:!0,order:[],ajax:{url:SITE_URL+ROUTER_DIRECTORY+ROUTER_CLASS+"/render_timesheet_datatable",data:{year:year,month:month}},columnDefs:[{targets:[-1],orderable:!1}],initComplete:function(){$('[data-toggle="tooltip"]').tooltip()}})}$(domReady),$("body").on("click","td[data-calday='allowed_day']",function(e){var t=$(this).find("span.date_value").attr("data-date");t&&($(this).hasClass("selected")?($(this).removeClass("selected"),selectedDate.splice($.inArray(t,selectedDate),1)):($(this).addClass("selected"),selectedDate.push(t))),$('input[name="selected_date"]').val(selectedDate.join())}),$("#clear_selected_days").on("click",function(e){e.preventDefault(),selectedDate=[],$('input[name="selected_date"]').val(""),$(".day").removeClass("selected")});